# Release 0.2.2: Vision, Orientation & Arrow Refinements

**Date:** 2026-02-20  
**Type:** UX Fixes & Behavior Normalization

## Summary

This release addresses critical UX issues caught during pre-merge testing, normalizes player vision/orientation behavior, and refines arrow rendering to professional quality.

## Fixes

### Vision System Normalization
- **Vision now defaults to OFF** via normalization (`undefined` → `false`)
- **Global `showVision`** is opt-in:
  - `true` = enables vision globally
  - `false` or `undefined` = disables vision (normalized to `false`)
- **Per-player `showVision`**:
  - `false` = disables vision for that specific player
  - `undefined` = inherits global setting
- **Vision is NOT gated by zoom** (always visible when enabled, unlike arms which require zoom threshold)

### Keyboard Shortcuts
- **V** — Toggle vision override for selected player(s)
- **Shift+V** — Deterministic "all players" toggle:
  - If ANY player has vision OFF → turn all ON
  - If ALL players have vision ON → turn all OFF

### Player Orientation
- **Default orientation:** `0` degrees (north/up)
- **Orientation transforms** on portrait ↔ landscape rotation
- **Arms rendering** gated by `zoomThreshold` (default 100%)
- **Number rotation** always readable (180° flip when upside-down)
- **Arms z-index fix:** Arms now render ABOVE body (visible on all shapes including circles)

### Arrow Rendering
- **Pass arrows:** White (#ffffff)
- **Run arrows:** White (#ffffff)
- **Shoot arrows:** Red (#ef4444) with professional arrowhead:
  - Proper unit vector geometry (ux, uy, px, py)
  - Fill-only arrowhead (no stroke outline)
  - Shaft lines stop cleanly at arrowhead base
  - Larger dimensions (18px × 12px) for prominent "shot" look
  - Smooth caps (`lineCap="round"`, `lineJoin="round"`)
  - Consistent hitbox (`hitStrokeWidth={15}`)
  - Non-interactive arrowhead (`listening={false}`)

### Zone Default Color
- **Changed:** Green (#22c55e) → Red (#ef4444)

## Behavior Contracts

### Vision
- Global `showVision`:
  - `true` = vision enabled globally
  - `false` or `undefined` = vision disabled (normalized to `false`)
- Per-player `showVision`:
  - `false` = disabled for that player
  - `undefined` = inherits global setting
- Vision is NOT zoom-gated (unlike arms)

### Orientation
- Default: `0` degrees (north)
- Transforms on rotate-portrait/landscape
- Arms visibility: gated by `zoomThreshold`
- Vision visibility: NOT zoom-gated (master switch only)

### Z-Order
- Player rendering: Vision → Body → Arms → Number
- Arms now always visible (not hidden by circle fills)

## Files Changed

**Vision/Orientation:**
- `packages/core/src/types.ts` — Type normalization
- `apps/web/src/store/slices/documentSlice.ts` — Vision normalization, rotate transform
- `apps/web/src/hooks/useKeyboardShortcuts.ts` — Deterministic Shift+V
- `packages/board/src/PlayerNode.tsx` — Arms z-index, number rotation

**Arrows:**
- `packages/core/src/board.ts` — Default colors
- `packages/board/src/ArrowNode.tsx` — Shot arrowhead geometry

**Zones:**
- `packages/core/src/board.ts` — Default color

## Migration Notes

**Documents with `showVision: undefined`:**
- Will now correctly default to OFF (normalized)
- Existing documents with `showVision: true` unchanged

**Player orientation:**
- Players without orientation will default to `0` (north)
- Existing orientations preserved and transform on rotate

**No breaking changes** — all fixes are UX improvements and normalization.
